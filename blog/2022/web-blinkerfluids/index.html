<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Web - BlinkerFluids Writeup | Dwiki Kusuma</title> <meta name="author" content="Dwiki Kusuma"> <meta name="description" content="Writeup for BlinkerFluids Challenge. Cyber Apocalypse CTF 2022 - Intergalactic Chase"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%83&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://qlkwej.github.io/blog/2022/web-blinkerfluids/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Web - BlinkerFluids Writeup",
      "description": "Writeup for BlinkerFluids Challenge. Cyber Apocalypse CTF 2022 - Intergalactic Chase",
      "published": "May 16, 2022",
      "authors": [
        {
          "author": "Dwiki Kusuma",
          "authorURL": "https://twitter.com/qlkwej",
          "affiliations": [
            {
              "name": "qlkwej",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Dwiki </span>Kusuma</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Web - BlinkerFluids Writeup</h1> <p>Writeup for BlinkerFluids Challenge. Cyber Apocalypse CTF 2022 - Intergalactic Chase</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#tl-dr">TL;DR</a></div> <div><a href="#challenge-description">Challenge Description</a></div> <div><a href="#problem">Problem</a></div> <div><a href="#attack-vectors">Attack vectors</a></div> <ul> <li><a href="#checking-the-package-json">Checking the package.json</a></li> </ul> <div><a href="#solution">Solution</a></div> <div><a href="#lesson-learned">Lesson Learned</a></div> <ul> <li><a href="#checking-the-potential-pdf-engine-by-the-server-response-blackbox">Checking the potential pdf engine by the Server response (blackbox)</a></li> <li><a href="#potential-ssti-on-the-pdf-engine-blackbox">Potential SSTI on the pdf engine (blackbox)</a></li> <li><a href="#potential-xss-on-the-pdf-engine-blackbox">Potential XSS on the pdf engine (blackbox)</a></li> </ul> </nav> </d-contents> <details><summary>Disclaimer</summary> <p>I am not a CTF addict nor maniac, I do CTF for fun and learning purpose. So, if you are looking for a writeup that is very detailed and easy to understand, I suggest you to find another writeup.</p> <p>This writeup is just a note for myself and maybe for someone who is looking for a hint to solve the challenge. Feedback / comments / PRs are welcome :)</p> </details> <h2 id="tldr">TL;DR</h2> <p>This writeup is about BlinkerFluids challenge from Cyber Apocalypse CTF 2022 - Intergalactic Chase. To get the flag we need to exploit the RCE vulnerability on the markdown parser engine.</p> <h2 id="challenge-description">Challenge Description</h2> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Upon checking the challenge description, we are given a short description about the challenge.</p> <blockquote> <p>Once known as an imaginary liquid used in automobiles to make the blinkers work is now one of the rarest fuels invented on Klaus’ home planet Vinyr. The Golden Fang army has a free reign over this miraculous fluid essential for space travel thanks to the Blinker Fluids corp. Ulysses has infiltrated this supplier organization one of the HR departement tools and needs your help to get into their server. Can you help him?</p> </blockquote> <p>Let start the challenge by visiting the given link.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>It’s an invoice web application, let’s take a look.</p> <hr> <h2 id="problem">Problem</h2> <p>This challenges provide us with a source code, so we can check the source code to find the vulnerability.</p> <pre><code class="language-javscript">&lt;!-- the file on main.js --&gt;


    $(document).ready(function() {
        listInvoice();
        $('#create-btn').on('click', showForm);
        $('#save-btn').on('click', addInvoice);
        window.easyMDE = new EasyMDE({element: $('#markdown_content')[0], renderingConfig: {singleLineBreaks: false}});
    });

    const showForm = () =&gt; {
        $('#invoices_view').hide();
        $('#markdown_view').slideDown();
    }

    const populateTable = (data) =&gt; {
        tRow = `&lt;tr&gt;
                    &lt;td&gt;${data.invoice_id}&lt;/td&gt;
                    &lt;td&gt;${data.created}&lt;/td&gt;
                    &lt;td&gt;&lt;a href="/static/invoices/${data.invoice_id}.pdf" target="_blank"&gt;PDF&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;a href="#" onclick="removeInvoice('${data.invoice_id}')"&gt;Delete&lt;/a&gt;&lt;/td&gt;
                &lt;/tr&gt;`;
        $('#invoice-list').append(tRow);
    }

    const listInvoice = async () =&gt; {
        await fetch('/api/invoice/list', {
            method: 'GET'
        })
        .then((response) =&gt; response.json()
            .then((data) =&gt; {
                if (response.status == 200) {
                    for (let row of data) {
                        populateTable(row);
                    }
                    return;
                }
            }))
        .catch((error) =&gt; {
            console.log(error);
        });
    };

    const removeInvoice = async (invoice_id) =&gt; {
        await fetch('/api/invoice/delete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({invoice_id}),
        })
        .then((response) =&gt; {
            location.reload();
        })
        .catch((error) =&gt; {
            console.log(error);
        });
    }

    const addInvoice = async () =&gt; {

        $('#save-btn').prop('disabled', true);

        let card = $('#resp-msg');
        card.hide();

        let loading = $('#loading_view');
        loading.show();
        $('.pdf_frame').hide();

        let markdown_content = window.easyMDE.value();

        if ($.trim(markdown_content) === '') {
            $('#save-btn').prop('disabled', false);
            card.text('Please add some content first!');
            card.attr('class', 'alert alert-danger');
            card.show();
            loading.hide();
            return;
        }

        await fetch('/api/invoice/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({markdown_content}),
            })
            .then((response) =&gt; response.json()
                .then((data) =&gt; {
                    if (response.status == 200) {
                        window.setTimeout(function() {
                            loading.hide();
                            location.reload();
                            }, 2500);
                            return;
                    } else {
                        loading.hide();
                        card.text(data.message);
                        card.attr('class', 'alert alert-danger');
                        card.show();
                    }
                }))
            .catch((error) =&gt; {
                loading.hide();
                card.text(error);
                card.attr('class', 'alert alert-danger');
                card.show();
            });
    }
</code></pre> <p>What I found from the source code:</p> <ol> <li>Path of the invoice is <code class="language-plaintext highlighter-rouge">/static/invoices/${data.invoice_id}.pdf</code> </li> <li>API to delete the invoice <code class="language-plaintext highlighter-rouge">await fetch('/api/invoice/delete', {...}</code> </li> <li>API to add the invoice <code class="language-plaintext highlighter-rouge">await fetch('/api/invoice/add', {...}</code> </li> </ol> <hr> <h2 id="attack-vectors">Attack vectors</h2> <p>Let’s use the application as it is, and see what we can do with it. We can create the invoice, delete the invoice, and see the invoice.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The potential threat of this application is the engine to render the invoice.</p> <ul> <li>How the engine works?</li> </ul> <p>Will discuss more on the obstacle later in <code class="language-plaintext highlighter-rouge">lesson-leared</code> section.</p> <p>After several attempt, finnaly I found the potential starting point to exploit the application.</p> <h3 id="checking-the-packagejson">Checking the package.json</h3> <p>In package.json we can see the details of package that used in the application, one of the package that cought my attention is <code class="language-plaintext highlighter-rouge">md-to-pdf</code>. Because it’s the <code class="language-plaintext highlighter-rouge">engine</code> to compile the invoice to pdf.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-8.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Checking the version <code class="language-plaintext highlighter-rouge">md-to-pdf</code> is <code class="language-plaintext highlighter-rouge">v4.1.0</code> it has a critical security issue based on synk information.<d-footnote>https://snyk.io/advisor/npm-package/md-to-pdf</d-footnote></p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-9.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Digging depper on <code class="language-plaintext highlighter-rouge">md-to-pdf</code> package, I found the package was vulnerable to a Remote Code Execution with 9.8 score which indicate the severity is critical.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-11.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>To validate the assumption, I try to create a simple payload to check if the application is vulnerable to RCE by calling the Burp collabolator server with <code class="language-plaintext highlighter-rouge">curl</code> command.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-12.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>It’s confirmed that the application is vulnerable to RCE. ***</p> <h2 id="solution">Solution</h2> <p>Because I’m too lazy to use VPS to exploit this issue, I use Burp Collaborator instead, another alternative can use https://webhook.site/</p> <p>First, I try to read the <code class="language-plaintext highlighter-rouge">/etc/passwd</code> If we can retrieve it, it means we can read any file in the server.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-13.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Then, I check the file in the current working directory (CWD) and one level above the CWD. I found the <code class="language-plaintext highlighter-rouge">flag.txt</code> file</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-14.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Read the flag.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-15.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>flag: <code class="language-plaintext highlighter-rouge">HTB{bl1nk3r_flu1d_f0r_int3rG4l4c7iC_tr4v3ls}</code></p> <hr> <h2 id="lesson-learned">Lesson Learned</h2> <p>I learn several things from this challenge:</p> <h3 id="checking-the-potential-pdf-engine-by-the-server-response-blackbox">Checking the potential pdf engine by the Server response (blackbox)</h3> <p>I didn’t check the source code yet, on this point I guess the engine is related to node.js application and I found this article<d-footnote>https://www.smashingmagazine.com/2019/04/nodejs-express-api-markdown-html/</d-footnote>. I thought the application is using <code class="language-plaintext highlighter-rouge">showdown</code> markdown parser. Later I found it’s a rabbit hole, since it’s not used in <code class="language-plaintext highlighter-rouge">package.json</code>.</p> <h3 id="potential-ssti-on-the-pdf-engine-blackbox">Potential SSTI on the pdf engine (blackbox)</h3> <p>I didn’t check the source code yet, on this point I guess there is a potential SSTI issue during the renderring process. I try several SSTI payload such as <code class="language-plaintext highlighter-rouge">{ { 7*7 } } &lt;% 7*7 %&gt; #{7*7}</code> etc.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-4.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>None of them work. I thought the application is vulnerable. Later I found it’s a rabbit hole, because it using <code class="language-plaintext highlighter-rouge">nunjucks</code> template language for javascript but it used in front-end not in back-end</p> <h3 id="potential-xss-on-the-pdf-engine-blackbox">Potential XSS on the pdf engine (blackbox)</h3> <p>I didn’t check the source code yet, on this point I guess there is a potential XSS issue during the renderring process. I try several XSS payload using <code class="language-plaintext highlighter-rouge">&lt;iframe&gt;</code> tag.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-6.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/blinker-7.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>It works, but with no impact and not related to this challenge, so I skiped it.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"qlkwej/qlkwej.github.io","data-repo-id":"R_kgDOJ99hCg","data-category":"General","data-category-id":"DIC_kwDOJ99hCs4CYD9z","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Dwiki Kusuma. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>